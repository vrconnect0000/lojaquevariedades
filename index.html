<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OQUE? VARIEDADES | Loja Oficial</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { 
            --bg-dark: #070707; 
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-dark); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }

        header {
            width: 100%; padding: 25px 5%;
            display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; z-index: 1000;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            background: rgba(7, 7, 7, 0.8);
        }

        .logo-text { 
            font-family: 'Oswald', sans-serif; 
            font-size: 2.8rem; 
            letter-spacing: 2px; 
            line-height: 1;
            text-transform: uppercase;
        }

        #search-bar {
            position: fixed; top: 90px; left: 0; width: 100%; padding: 15px 5%;
            background: rgba(7,7,7,0.95); backdrop-filter: blur(10px);
            z-index: 999; border-bottom: 1px solid var(--glass-border);
            transform: translateY(-150%); transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #search-bar.active { transform: translateY(0); }

        .category-pill {
            padding: 8px 18px; border-radius: 100px; border: 1px solid var(--glass-border);
            background: var(--glass); font-size: 10px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 1px; white-space: nowrap;
            transition: 0.3s; color: rgba(255,255,255,0.4);
        }
        .category-pill.active { background: #fff; color: #000; border-color: #fff; }

        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            padding: 0 4% 120px; 
        }
        @media (min-width: 1024px) { 
            .grid-container { grid-template-columns: repeat(4, 1fr); padding: 0 8% 150px; gap: 25px; } 
        }

        .product-card { 
            background: var(--glass); border: 1px solid var(--glass-border); 
            padding: 8px; border-radius: 16px; transition: 0.3s;
            display: flex; flex-direction: column;
        }
        
        .img-wrapper {
            width: 100%; aspect-ratio: 3/4; background: #000;
            border-radius: 12px; overflow: hidden; margin-bottom: 10px;
            display: flex; align-items: center; justify-content: center;
        }
        .product-card img { width: 100%; height: 100%; object-fit: contain; }

        .side-panel {
            position: fixed; right: 0; top: 0; height: 100%; width: 100%;
            background: #0a0a0a; z-index: 2000; padding: 25px;
            transform: translateX(100%); transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @media (min-width: 768px) { .side-panel { max-width: 450px; border-left: 1px solid var(--glass-border); } }
        .side-panel.active { transform: translateX(0); }

        .btn-main {
            padding: 14px; border: 1px solid #fff; color: #fff;
            font-weight: 800; text-transform: uppercase; font-size: 0.7rem; 
            letter-spacing: 2px; transition: 0.3s; background: transparent; width: 100%;
        }
        .btn-main:hover { background: #fff; color: #000; }

        .mobile-nav {
            position: fixed; bottom: 0; width: 100%; 
            background: rgba(7, 7, 7, 0.9); backdrop-filter: blur(15px);
            border-top: 1px solid var(--glass-border);
            padding: 12px; display: flex; justify-content: space-around; z-index: 1500;
        }
        @media (min-width: 768px) { .mobile-nav { display: none; } }
        
        .hide-scroll::-webkit-scrollbar { display: none; }
        .thumb-img { width: 60px; height: 60px; object-fit: contain; background: #111; border: 1px solid var(--glass-border); border-radius: 8px; cursor: pointer; }
        .thumb-img.active { border-color: #fff; }

        /* Estilo da Mensagem de Sucesso TOP */
        #success-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px); z-index: 5000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .success-card {
            background: #111; border: 1px solid var(--glass-border);
            padding: 40px 30px; border-radius: 30px; text-align: center;
            max-width: 400px; width: 100%;
        }
    </style>
</head>
<body>

    <div id="success-modal">
        <div class="success-card" data-aos="zoom-in">
            <div class="w-20 h-20 bg-white text-black rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-check text-3xl"></i>
            </div>
            <h2 class="text-2xl font-black italic uppercase mb-2">Pedido Confirmado</h2>
            <p class="text-gray-400 text-sm leading-relaxed mb-8">Em breve, nossa equipe entrará em contato com você pelo WhatsApp para finalizar a compra.</p>
            <button onclick="document.getElementById('success-modal').style.display='none'" class="btn-main bg-white text-black border-none">Explorar mais produtos</button>
        </div>
    </div>

    <div id="toast-container" class="fixed top-20 right-5 z-[9999]"></div>

    <header>
        <div class="logo-text">OQUE? <span style="font-weight: 300; opacity: 0.5; font-size: 0.6em;">VARIEDADES</span></div>
        <div class="flex gap-5 items-center">
            <button onclick="toggleSearch()"><i class="fa-solid fa-magnifying-glass text-lg opacity-70"></i></button>
            <button onclick="toggleCart()" class="relative">
                <i class="fa-solid fa-bag-shopping text-xl"></i>
                <span class="cart-count-badge absolute -top-2 -right-2 bg-white text-black text-[9px] font-black rounded-full h-4 w-4 flex items-center justify-center">0</span>
            </button>
        </div>
    </header>

    <div id="search-bar">
        <input type="text" id="input-busca" oninput="filtrarBusca()" placeholder="O QUE VOCÊ PROCURA?" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-xl text-xs font-bold tracking-widest">
    </div>

    <section class="pt-32 pb-6 px-6">
        <div id="categories-list" class="flex gap-3 overflow-x-auto hide-scroll py-2"></div>
    </section>

    <div id="product-grid" class="grid-container"></div>

    <div id="cart-panel" class="side-panel flex flex-col">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-black italic uppercase">Sacola</h2>
            <button onclick="toggleCart()" class="text-3xl">&times;</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto hide-scroll space-y-4"></div>
        
        <div class="mt-4 pt-4 border-t border-white/10">
            <label class="text-[10px] font-black uppercase opacity-50 block mb-2">Forma de Pagamento</label>
            <select id="pagamento-select" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-xs font-bold text-white outline-none">
                <option value="Pix" class="bg-black">Pix</option>
                <option value="Cartão de Crédito" class="bg-black">Cartão de Crédito</option>
                <option value="Crediário da Loja" class="bg-black">Crediário da Loja</option>
                <option value="Dinheiro" class="bg-black">Dinheiro</option>
            </select>
        </div>

        <div class="pt-6 border-t border-white/10 mt-4">
            <div class="flex justify-between font-black text-xl mb-6">
                <span>TOTAL</span>
                <span id="cart-total">R$ 0,00</span>
            </div>
            <button onclick="finalizarPedido()" id="btn-finalizar" class="btn-main bg-white text-black">Finalizar Pedido</button>
        </div>
    </div>

    <div id="details-panel" class="side-panel overflow-y-auto hide-scroll">
        <button onclick="closeDetails()" class="text-[10px] font-black tracking-widest text-gray-500 mb-6 uppercase">&larr; Voltar</button>
        <div id="details-body"></div>
    </div>

    <div id="profile-modal" class="fixed inset-0 bg-black/95 z-[3000] hidden flex items-center justify-center p-6 backdrop-blur-md">
        <div class="w-full max-w-sm bg-[#111] p-8 rounded-[25px] border border-white/5">
            <div id="profile-content"></div>
        </div>
    </div>

    <nav class="mobile-nav">
        <button onclick="window.scrollTo({top:0, behavior:'smooth'})"><i class="fa-solid fa-house text-lg opacity-50"></i></button>
        <button onclick="toggleCart()" class="relative"><i class="fa-solid fa-bag-shopping text-lg opacity-50"></i></button>
        <button onclick="toggleProfile()"><i class="fa-solid fa-user-gear text-lg"></i></button>
    </nav>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();
        const SUPABASE_URL = "https://zkhradhpwakvtgsilsyj.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_UrUxPsPD3XBTANwwp3tZOA_-REppnf3";
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let products = [], cart = [], currentCat = 'Todos';

        async function fetchProducts() {
            const { data } = await _supabase.from('produtos').select('*').order('id', { ascending: false });
            products = data || [];
            setupCategories();
            renderProducts(products);
        }

        function setupCategories() {
            const cats = ['Todos', ...new Set(products.map(p => p.categoria).filter(c => c))];
            document.getElementById('categories-list').innerHTML = cats.map(c => `
                <button onclick="filterByCategory('${c}')" class="category-pill ${c === currentCat ? 'active' : ''}">${c}</button>
            `).join('');
        }

        function filterByCategory(cat) {
            currentCat = cat; setupCategories();
            const filtered = cat === 'Todos' ? products : products.filter(p => p.categoria === cat);
            renderProducts(filtered);
        }

        function filtrarBusca() {
            const termo = document.getElementById('input-busca').value.toLowerCase();
            renderProducts(products.filter(p => p.nome.toLowerCase().includes(termo)));
        }

        function renderProducts(lista) {
            document.getElementById('product-grid').innerHTML = lista.map(p => `
                <div class="product-card" onclick="showProductDetails(${p.id})" data-aos="fade-up">
                    <div class="img-wrapper"><img src="${p.imagem_url}" loading="lazy"></div>
                    <h3 class="text-[10px] font-bold uppercase opacity-40 truncate">${p.nome}</h3>
                    <p class="text-lg font-black italic">R$ ${parseFloat(p.preco).toFixed(2).replace('.', ',')}</p>
                </div>
            `).join('');
        }

        function showProductDetails(id) {
            const p = products.find(x => x.id === id);
            const imgs = [p.imagem_url, p.imagem_url_2, p.imagem_url_3, p.imagem_url_4].filter(u => u);
            document.getElementById('details-body').innerHTML = `
                <div class="space-y-6">
                    <div class="w-full aspect-square bg-black rounded-2xl flex items-center justify-center overflow-hidden">
                        <img id="main-view-img" src="${p.imagem_url}" class="w-full h-full object-contain">
                    </div>
                    <div class="flex gap-2 overflow-x-auto hide-scroll">${imgs.map((u, i) => `<img src="${u}" onclick="document.getElementById('main-view-img').src='${u}'" class="thumb-img">`).join('')}</div>
                    <h2 class="text-3xl font-black italic uppercase">${p.nome}</h2>
                    <p class="text-2xl font-bold">R$ ${parseFloat(p.preco).toFixed(2).replace('.', ',')}</p>
                    <p class="text-sm text-gray-400 leading-relaxed">${p.descricao || ''}</p>
                    <div class="pt-4 space-y-3">
                        <button onclick="addToCart(${p.id})" class="btn-main bg-white text-black font-black border-none">Adicionar à Bag</button>
                    </div>
                </div>
            `;
            document.getElementById('details-panel').classList.add('active');
        }

        function renderProfile() {
            const data = JSON.parse(localStorage.getItem('oque_profile'));
            const content = document.getElementById('profile-content');
            if (data?.nome) {
                content.innerHTML = `
                    <div class="text-center mb-6"><div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fa-solid fa-user text-2xl"></i></div><h2 class="font-black italic uppercase">Olá, ${data.nome.split(' ')[0]}</h2></div>
                    <div class="bg-white/5 p-4 rounded-xl border border-white/10 mb-6 space-y-2 text-xs">
                        <p class="text-gray-500 uppercase font-black text-[9px]">Seus Dados</p>
                        <p><i class="fa-brands fa-whatsapp text-green-500"></i> ${data.whatsapp}</p>
                        <p><i class="fa-solid fa-location-dot"></i> ${data.rua}, ${data.numero}</p>
                        <p>${data.bairro}</p>
                    </div>
                    <button onclick="localStorage.removeItem('oque_profile');renderProfile()" class="w-full text-[10px] text-red-500 font-black uppercase mb-4">Sair do Perfil</button>
                    <button onclick="toggleProfile()" class="btn-main bg-white text-black font-black border-none">Voltar</button>
                `;
            } else {
                content.innerHTML = `
                    <h2 class="text-center font-black italic mb-6 uppercase text-sm">Dados de Entrega</h2>
                    <div class="space-y-3">
                        <input type="text" id="p-nome" placeholder="Nome Completo" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 text-sm outline-none">
                        <input type="tel" id="p-whatsapp" placeholder="WhatsApp (DDD + Número)" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 text-sm outline-none">
                        <input type="text" id="p-rua" placeholder="Rua" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 text-sm outline-none">
                        <div class="flex gap-2"><input type="text" id="p-numero" placeholder="Nº" class="w-1/3 bg-white/5 p-4 rounded-xl border border-white/10 text-sm outline-none"><input type="text" id="p-bairro" placeholder="Bairro" class="w-2/3 bg-white/5 p-4 rounded-xl border border-white/10 text-sm outline-none"></div>
                        <input type="text" id="p-referencia" placeholder="Ponto de Referência" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 text-sm outline-none">
                        <button onclick="saveProfile()" class="btn-main bg-white text-black font-black mt-4">Salvar Dados</button>
                        <button onclick="toggleProfile()" class="w-full text-[10px] opacity-40 uppercase mt-4 text-center">Fechar</button>
                    </div>
                `;
            }
        }

        function saveProfile() {
            const d = { 
                nome: document.getElementById('p-nome').value, 
                whatsapp: document.getElementById('p-whatsapp').value,
                rua: document.getElementById('p-rua').value, 
                numero: document.getElementById('p-numero').value, 
                bairro: document.getElementById('p-bairro').value, 
                ref: document.getElementById('p-referencia').value 
            };
            if(!d.nome || !d.whatsapp || !d.rua) return alert("Preencha Nome, WhatsApp e Rua.");
            localStorage.setItem('oque_profile', JSON.stringify(d)); renderProfile();
        }

        function addToCart(id) {
            cart.push(products.find(x => x.id === id));
            updateCartUI(); closeDetails();
            const t = document.createElement('div'); t.className = "fixed top-20 right-5 bg-white text-black p-4 rounded-full text-[9px] font-black uppercase z-[9999]";
            t.innerText = "Adicionado!"; document.body.appendChild(t); setTimeout(() => t.remove(), 2000);
        }

        function updateCartUI() {
            let total = 0;
            document.getElementById('cart-items').innerHTML = cart.map((item, i) => {
                total += parseFloat(item.preco);
                return `<div class="flex items-center gap-4 bg-white/5 p-3 rounded-xl"><img src="${item.imagem_url}" class="w-10 h-10 object-contain rounded"><div class="flex-1 text-[10px] font-bold uppercase truncate">${item.nome}</div><button onclick="cart.splice(${i},1);updateCartUI()" class="opacity-30">&times;</button></div>`;
            }).join('');
            document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2).replace('.', ',')}`;
            document.querySelectorAll('.cart-count-badge').forEach(b => b.innerText = cart.length);
        }

        async function finalizarPedido() {
            const user = JSON.parse(localStorage.getItem('oque_profile'));
            if(!user?.nome) return toggleProfile();
            if(!cart.length) return alert("Sua sacola está vazia!");

            const btn = document.getElementById('btn-finalizar');
            btn.disabled = true; btn.innerText = "ENVIANDO...";

            const { error } = await _supabase.from('vendas').insert([{
                cliente_nome: user.nome,
                cliente_whatsapp: user.whatsapp,
                endereco: `${user.rua}, ${user.numero} - ${user.bairro}`,
                referencia: user.ref,
                itens: cart.map(i => i.nome).join(', '),
                total: cart.reduce((a, b) => a + parseFloat(b.preco), 0),
                pagamento: document.getElementById('pagamento-select').value,
                status: 'Pendente'
            }]);

            if(!error) {
                // EXIBE O MODAL ELEGANTE EM VEZ DO ALERT
                document.getElementById('success-modal').style.display = 'flex';
                cart = []; updateCartUI(); toggleCart();
            } else {
                alert("Erro ao processar o pedido. Tente novamente.");
            }
            btn.disabled = false; btn.innerText = "Finalizar Pedido";
        }

        function toggleSearch() { document.getElementById('search-bar').classList.toggle('active'); }
        function toggleCart() { document.getElementById('cart-panel').classList.toggle('active'); }
        function toggleProfile() { renderProfile(); document.getElementById('profile-modal').classList.toggle('hidden'); }
        function closeDetails() { document.getElementById('details-panel').classList.remove('active'); }
        window.onload = fetchProducts;
    </script>
</body>
</html>
